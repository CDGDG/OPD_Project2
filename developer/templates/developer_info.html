{% extends "base.html" %}

{% block content %}

<!-- Password Modal -->
<div id ="passwordModal"  class="modal fade" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">현재 비밀번호 확인</h4>
            </div>
            <div class="modal-body">    
                <p>현재 비밀번호를 입력해주세요</p>
                <input type="password" class="form-control mt-1" id="current_password" placeholder="비밀번호를 입력해주세요">
                <div id="check"></div>
            </div>
            <div class="modal-footer"> 
                <button class="btn btn-primary" id ="check_password">확인</button>
                <button class="btn btn-primary" data-bs-dismiss="modal">취소</button>
            </div>
        </div>
    </div>
</div>
{% if developer.id == request.session.id %}
<div class="row mt-5">
    <div class="col-12">
        <div class="form-group">
            <h4>{{developer.nickname}}</h4>
            <label for="프로필 사진">프로필 사진</label><br>
            {% if developer.pic %}
            <img src="{{developer.pic.url}}" alt="사진 없음"><br>
            {% else %}
            <img src="/media/user_icon.png/" alt="사진 없음"><br>
            {% endif %}
            <label for="userid">아이디</label> : {{developer.userid}}<br>
            <label for="email">이메일</label> : {{developer.email}}<br>
            <label for="regdate">가입일</label> : {{developer.regdate|date:"Y년 m월 d일"}}<br>
            <label for="birthday">생년월일</label> : {{birth.year}}년 {{birth.month}}월 {{birth.day}}일<br>
            <label for="age">나이</label> : {{birth.age}}<br>
            <label for="gender">성별</label> : {{gender}}<br>     
            <label for = "resume"> 이력서</label> :
            {% if developer.resume %}
            <a class="btn btn-primary" href ="{% url 'Developer:resume_download' developer.id %}">{{developer.resume.name}}</a>
            {% else %}
            등록된 이력서가 없습니다.
            {% endif %}
        </div>
        <div class="mt-3">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#passwordModal">수정하기</button>
        </div>
        
    </div>
</div>
{% else %}
<div class="row mt-5">
    <div class="col-12">
        <div class="form-group">
            <h4>{{developer.nickname}}</h4>
            <label for="프로필 사진">프로필 사진</label><br>
            {% if developer.pic %}
            <img src="{{developer.pic.url}}" alt="사진 없음"><br>
            {% else %}
            <img src="/media/user_icon.png/" alt="사진 없음"><br>
            {% endif %}
            <label for="userid">아이디</label> : {{developer.userid}}<br>
            <label for="email">이메일</label> : {{developer.email}}<br>
            <label for="regdate">가입일</label> : {{developer.regdate|date:"Y년 m월 d일"}}<br>
            <label for="birthday">생년월일</label> : {{birth.year}}년 {{birth.month}}월 {{birth.day}}일<br>
            <label for="age">나이</label> : {{birth.age}}<br>
            <label for="gender">성별</label> : {{gender}}<br>     
        </div>
        <div class="mt-3">
            <a class="btn btn-primary" href="{% url 'Developer:myproject' developer.id %}">{{developer.nickname}}님의 프로젝트 보러가기</a>
        </div>
        
    </div>
</div>
{% endif %}
{% endblock %}
{% block script %}
    <script>
        $(document).ready(function(){
            $('#check_password').click(function(){
                    var password = $("#current_password").val();
                    var check = "check"
                    console.log(password)
                    $.ajax({
                        url:"{% url 'Developer:checkPassword' %}",
                        type:"POST",
                        data : {'csrfmiddlewaretoken': '{{csrf_token}}','password':password,'check':check},
                        datatype:'json',
                        success:function(response){
                            if(response.blank){
                                $('#check').html('<p style="color:red">비밀번호를 입력해주세요</p>')
                                return;
                            }else if(response.data == "fail"){
                                $('#check').html('<p style="color:red">비밀번호가 틀립니다</p>')
                                return;
                            }else{
                                location.href = "{% url 'Developer:update' %}"
                            }
                        }
                    })
            })

        })
    </script>
{% endblock script %}
