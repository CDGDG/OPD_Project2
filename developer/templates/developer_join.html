{% extends 'base.html' %}
{% load bootstrap4 %}
{% block content %}
<link rel="stylesheet" href="/static/css/create.css">
<script src="/static/js/create.js"></script>
<div class="row mt-5">
    <div class="col-12">
        <form method="POST" action="{% url 'Developer:join' %}" enctype="multipart/form-data" name="joinfrm" id="form_id">
            <h2 class="mb-4">개발자 회원가입</h2>
            {% csrf_token %}
            {% for field in form %}
            <div class="form-group">
                {% comment %} 언어 선택 {% endcomment %}
                {% if field.name == 'language' %}
                {% comment %} <label>{{field.label}}</label>
                <ul class='form-control' style='list-style-type: none;'>
                    {% for f in field %}
                    <li>{{f}}</li>
                    {% endfor %}
                </ul> {% endcomment %}
                {% bootstrap_field field %}
                <div id="check_{{field.name}}"></div>
                {% comment %} 휴대폰번호 {% endcomment %}
                {% elif field.name == 'phonenum'%}
                    <input type="hidden" name="{{ field.name }}" id="id_phonenum"/>
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    <input type="text" class="form-control noani" style="width:5%; display:inline-block" id="{{ field.id_for_label }}1"
                    placeholder="000" name="{{ field.name }}1" maxlength="3"/><span style="width: auto;margin: auto 0;color: lightcoral;font-weight: 900;"> - </span>
                    <input type="text" class="form-control noani" style="width:5%; display:inline-block" id="{{ field.id_for_label }}2"
                    placeholder="0000" name="{{ field.name }}2" maxlength="4"/><span style="width: auto;margin: auto 0;color: lightcoral;font-weight: 900;"> - </span>
                    <input type="text" class="form-control noani" style="width:5%; display:inline-block" id="{{ field.id_for_label }}3"
                    placeholder="0000" name="{{ field.name }}3" maxlength="4"/>
                    <div id="check_{{field.name}}"></div>
                {% comment %} 이메일 {% endcomment %}
                {% elif field.name == 'email_option'%}
                @<input type="{{field.field.widget.input_type}}" id="email_option" name="{{field.name}}" class="form-control">
                <select id="email_select">
                    <option value="">직접입력</option>
                    <option value="naver.com">naver.com</option>
                        <option value="gmail.com">gmail.com</option>
                        <option value="daum.net">daum.net</option>
                    </select>
                    <input type="button" value="이메일 인증" id="send_email" name ='send_email'>
                    <div id="check_{{field.name}}"></div>
                    <input type="text" placeholder="인증번호를 입력해 주세요" id="emailnum" name="emailnum" class="form-control" style="display:none">
                    <input type="button" value="인증하기" id="check_emailnum" name="check_emailnum" style="display:none">
                    <div id="check_email_result"></div>
                {% comment %} 주민등록번호 {% endcomment %}
                {% elif field.name == 'registnum'%}
                    <input type="hidden" name="{{ field.name }}" id="id_registnum"/>
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    <div class="mt-1 row mx-0 justify-content-md-center registnumdiv" style="border: 1px solid #ced4da;border-radius: 0.25rem;padding: 0.375rem 0.75rem;">
                        <input type="text" class="d-inline-block col noani border-0 text-center" id="{{ field.id_for_label }}1"
                        placeholder="주민번호 앞자리" name="{{ field.name }}1" maxlength="6"/><span class='col-md-auto' style="margin: auto 0;color: lightcoral;font-weight: 900;"> - </span>
                        <input type="password" class="d-inline-block col noani border-0 text-center" id="{{ field.id_for_label }}2"
                        placeholder="주민번호 뒷자리" name="{{ field.name }}2"  maxlength="7"/>
                    </div>
                    <div id="check_{{field.name}}"></div>
                {% comment %} 비밀번호 {% endcomment %}
                {% elif field.name == 'password'%}
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                <input type="{{ field.field.widget.input_type }}" class="form-control" id="{{ field.id_for_label }}"
                title="최소 8자 이상이고 최소 1개 이상의 숫자, 특수문자, 영문 대소문자가 포함되어야 합니다." name="{{ field.name }}" />  
                {#<p>최소 8자 이상이고 최소 1개 이상의 숫자, 특수문자, 영문 대소문자가 포함되어야 합니다.</p>#}
                <div id="check_{{field.name}}"></div>
                {% comment %} 아이디 {% endcomment %}
                {% elif field.name == 'userid'%}
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                <input type="{{ field.field.widget.input_type }}" class="form-control" id="{{ field.id_for_label }}"
                title="영문자로 시작하고 최소 5개 이상의 숫자나 영문자가 포함되어야 합니다." name="{{ field.name }}" />
                {#<p>영문자로 시작하고 최소 5개 이상의 숫자나 영문자가 포함되어야 합니다.</p>#}
                <div id="check_{{field.name}}"></div>
                {% comment %} 아이디 중복검사 {% endcomment %}
                {#<input type="button" id="duple_userid" value="중복검사"><div id="dupleId_result"></div>#}
                <a class="btn btn-secondary position-absolute" id="duple_userid" title="중복검사를 진행해주세요.">중복검사</a>
                {% else %}
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                <input type="{{ field.field.widget.input_type }}" class="form-control" id="{{ field.id_for_label }}"
                placeholder="{{ field.label }}" name="{{ field.name }}" />
                <div id="check_{{field.name}}"></div>
                {% endif %}
                {% comment %} 닉네임 중복검사 {% endcomment %}
                {% if field.name == "nickname"%}
                <a class="btn btn-secondary position-absolute" id="duple_nickname" title="중복검사를 진행해주세요.">중복검사</a>
                {#<input type="button" id="duple_nickname" value="중복검사"><div id="dupleNick_result"></div>#}
                {% endif %}
                {% if field.errors %}
                <span class="text-danger">{{ field.errors }}</span>
                {% endif %}
            </div>
            <script>
                // 안내 메세지 툴팁
                if("{{field.id_for_label}}"){
                    $("#{{field.id_for_label}}").focus(function(){$(this).tooltip('show')})
                }
            </script>
            {% endfor %}
            <div class="">
            </div>
            <div class="px-0 text-end">
                <input type="button" class="btn btn-outline-secondary mt-3 mb-3" value="돌아가기" onclick="window.history.back()">
                <input type="button" class="btn btn-primary mt-3 mb-3" id='join' value="회원가입">
                {% comment %} <button type="submit" class="btn btn-primary mt-3">글쓰기</button> {% endcomment %}
            </div>
        </form>
    </div>
</div>
{% endblock content %}

{% block script %}
<script>
$(document).ready(function(){
    id_button = false; 
    nick_button = false;
    send_email = false;
    // 아이디 중복검사
    $('#duple_userid').tooltip({trigger: 'focus'}).click(function(){
        var userid=$('#id_userid').val()
        $.ajax({
            url: "{% url 'Developer:check_id' %}",
            data: {'userid': userid},
            datatype:'json',
    
            success : function(response){
                if(response.blank){
                    //$('#dupleId_result').html('<p>아이디를 입력해주세요</p>')
                    id_button = false;
                }else{
                    if(response.data == 'not exist'){
                        //$('#dupleId_result').html('<p style="color:green">사용가능한 아이디입니다</p>')
                        $("#duple_userid").removeClass('btn-secondary btn-danger').addClass('btn-success').attr({'data-bs-original-title': '사용 가능한 아이디입니다.'}).tooltip("show");
                        id_button = true
                        return;
                    }else{
                        //$('#dupleId_result').html('<p style="color:red">중복된 아이디입니다</p>')
                        $("#duple_userid").removeClass('btn-secondary btn-success').addClass('btn-danger').attr({'data-bs-original-title': '중복된 아이디입니다.'}).tooltip("show");
                        id_button = false
                        return;
                        
                    }
                    
                }
                
            }
            
        })
    })
    //닉네임 중복검사
    $('#duple_nickname').tooltip({trigger: 'focus'}).click(function(){
        var nickname=$('#id_nickname').val()
        $.ajax({
            url:"{% url 'Developer:check_nick' %}",
            data:{'nickname':nickname},
            datatype:'json',
            
            success : function(response){
                if(response.blank){
                    //$('#dupleNick_result').html('<p>닉네임을 입력해주세요</p>')
                    nick_button = false;
                }else{
                    if(response.data == 'not exist'){
                        //$('#dupleNick_result').html('<p style="color:green">사용가능한 닉네임입니다</p>')
                        $("#duple_nickname").removeClass('btn-secondary btn-danger').addClass('btn-success').attr({'data-bs-original-title': '사용 가능한 닉네임입니다.'}).tooltip("show");
                        nick_button=true;
                        return;
                    }else{
                        //$('#dupleNick_result').html('<p style="color:red">중복된 닉네임입니다</p>')
                        $("#duple_nickname").removeClass('btn-secondary btn-success').addClass('btn-danger').attr({'data-bs-original-title': '중복된 아이디입니다.'}).tooltip("show");
                        return;
                        
                    }
                    
                }
                
            }
        })
    })
    //이메일 인증
    $('#send_email').click(function(){
        var joinfrm = document.forms['joinfrm']
        var email_id = joinfrm['email_id'].value.trim()
        var email_option = joinfrm['email_option'].value.trim()
        
        //이메일 인증번호
        var num_list = []
        for(var i=0;i<4;i++){num_list.push(Math.floor(Math.random() * 10)+"")}
        var emailnum = num_list.join("")
        
        $.ajax({
            url:"{% url 'Developer:send_email' %}",
            data : {'email_id':email_id,'email_option':email_option,'emailnum':emailnum},
            datatype:'json',
            success:function(response){
                if(response.fail){
                    $('#check_email_option').html('<p style="color:red">이메일 인증에 실패 했습니다 다시 시도해주세요</p>')
                }
                if(response.blank){
                    $('#check_email_option').html('<p style="color:red">이메일을 입력해주세요</p>')
                }else{
                    $('#check_email_option').html('<p style="color:green">인증번호를 입력해주세요</p>')
                    $('#emailnum').css('display','block') 
                    $('#check_emailnum').css('display','block') //이메일 인증번호 입력란
                    $('#check_emailnum').click(function(){
                        $('#send_email').attr('value','다시 인증하기')
                        if(joinfrm['emailnum'].value.trim() == ""){
                            $('#check_email_result').html('<p style="color:red">인증번호를 입력해주세요</p>')
                            
                        }else if(joinfrm['emailnum'].value.trim() != emailnum){
                            $('#check_email_result').html('<p style="color:red">인증번호를 다시 확인해주세요</p>') //인증번호가 맞지 않을 때
                            
                        }else{
                            $('#check_email_result').html('<p style="color:green">인증되었습니다</p>')
                            send_email=true;
                            
                        }
                    })
                }
            }
        })
    })
})
</script>
<script src="/static/js/developer/developer_join.js"></script>
{% endblock script %}
